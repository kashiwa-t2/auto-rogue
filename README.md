# auto-rogue

Godot 4.x で開発するスマホ縦画面向けの放置ゲーム

## 開発環境

- Godot 4.3以上
- 解像度: 720x1280 (スマホ縦画面)

## プロジェクト構成

```
auto-rogue/
├── src/
│   ├── scenes/          # シーンファイル(.tscn)
│   │   ├── TitleScene.tscn      # タイトル画面
│   │   ├── MainScene.tscn       # メインゲーム画面
│   │   ├── Player.tscn          # プレイヤーキャラクター
│   │   ├── BasicEnemy.tscn      # 基本敵キャラクター
│   │   └── Coin.tscn            # コイン（回転アニメーション・価値表示）
│   └── scripts/         # スクリプトファイル(.gd)
│       ├── GameConstants.gd     # 定数管理 (autoload)
│       ├── SceneTransition.gd   # シーン遷移管理 (autoload)
│       ├── PlayerStats.gd       # プレイヤーステータス管理 (autoload)
│       ├── TitleScene.gd        # タイトル画面制御
│       ├── MainScene.gd         # メインシーン・戦闘・ダメージ制御
│       ├── GameOverScreen.gd    # ゲームオーバー画面制御
│       ├── UpgradeUI.gd         # 育成画面UI制御
│       ├── Player.gd            # プレイヤー・武器・HP制御
│       ├── Coin.gd              # コイン制御
│       ├── EnemyBase.gd         # 敵基底クラス（HP・ダメージ対応）
│       ├── BasicEnemy.gd        # 基本敵（突進攻撃・ダメージ処理）
│       ├── HPBar.gd             # HPバー表示コンポーネント
│       ├── DamageText.gd        # フロート式ダメージ数値表示
│       ├── UIPositionHelper.gd  # UI位置計算ヘルパー
│       ├── TestPlayer.gd        # テスト機能
│       ├── ScrollerBase.gd      # スクロール基底クラス
│       ├── BackgroundScroller.gd # 背景スクロール
│       ├── GroundScroller.gd    # 地面スクロール
│       └── ScrollManager.gd     # スクロール統合管理
├── assets/
│   └── sprites/kenney_pixel-platformer/
│       ├── Tiles/Backgrounds/   # 背景画像 (tile_0008~0011)
│       ├── Tiles/Characters/    # キャラ画像 (tile_0000~0001, tile_0018~0019)
│       └── Tiles/               # 地面画像 (tile_0022)、コイン画像 (tile_0151~0152)
│   └── sprites/kenney_tiny-dungeon/
│       └── Tiles/               # 武器画像 (tile_0103)
└── project.godot
```

## 動作確認

1. Godotエディタでプロジェクトを開く
2. F6キーで実行
3. **タイトル画面**: "AUTO ROGUE" タイトルとゲーム開始ボタンが表示
4. **ゲーム開始**: ボタンクリックまたはEnterキーでゲーム開始
5. **ゲーム画面構成**:
   - **上部1/3**: プレイエリア（背景・地面・プレイヤー・敵）
   - **下部2/3**: UIエリア（育成メニュー・コイン表示）
6. プレイヤーが地面上で歩行アニメーション
7. 背景・地面が右→左にスクロール
8. **敵が5秒間隔で出現**: 画面右端からBasicEnemyが無限に出現
9. **複数敵同時存在**: 複数の敵が画面上に同時に存在・移動
10. **1対1戦闘システム**: 最初に接近した敵とのみ戦闘・他の敵は待機
11. **順次戦闘**: 戦闘終了後、待機中の敵と自動で次の戦闘開始
12. **HP・ダメージシステム**: キャラクター上部にHPバー表示、攻撃時にダメージ数値が浮上
13. **コインシステム**: 敵撃破時にコインドロップ・自動取得・UI反映
14. **育成システム**: コインを使ったキャラクター・武器のレベルアップ
15. **ゲームオーバー**: プレイヤー死亡時に結果表示・タイトルへ戻る

## 主要機能

### スクロールシステム
- **背景スクロール**: 4枚画像の無限ループ
- **地面スクロール**: 1枚タイルの連続表示
- **統一管理**: ScrollManagerによる一元制御
- **戦闘時停止**: 戦闘中のスクロール自動制御

### プレイヤーシステム  
- **歩行アニメーション**: 2フレーム切り替え (4fps)
- **武器システム**: 剣による攻撃アニメーション・ダメージ処理
- **HPシステム**: 基本HP100・HPバー表示・被ダメージ処理・死亡時の消滅
- **ステータス成長**: キャラレベルでHP増加、武器レベルで攻撃力増加
- **ダメージ表示**: 被ダメージ時の大きなフロート数値表示
- **コイン取得**: 敵撃破時のコイン自動取得・UI反映
- **3倍スケール**: 視認性の向上
- **地面接地**: 自動位置調整
- **戦闘連携**: 敵接近時の自動攻撃開始

### エネミーシステム
- **時間ベース出現**: 5秒間隔でBasicEnemyが画面右端から無限出現
- **複数敵同時管理**: アクティブ敵配列による複数敵の同時存在・移動
- **歩行AI**: 左方向への自動移動・戦闘中でも移動継続
- **戦闘AI**: プレイヤー接近時の突進攻撃・ダメージ処理
- **待機システム**: 2体目以降の敵は戦闘待ちキューで自動待機
- **HPシステム**: HP100・HPバー表示・被ダメージ処理・死亡時の消滅
- **ダメージ表示**: 被ダメージ時の大きなフロート数値表示
- **攻撃タイミング**: 突進完了時の正確なダメージ判定
- **コインドロップ**: 死亡時に10-20コインのランダムドロップ
- **拡張可能設計**: EnemyBase継承による新敵タイプ追加対応

### 戦闘システム
- **1対1戦闘制御**: 複数敵存在下でも最初に接近した敵とのみ戦闘
- **戦闘ターゲット管理**: 明確な攻撃対象指定・他敵への誤攻撃防止
- **待機キューシステム**: 2体目以降の敵は自動待機・プレイヤー通り抜け防止
- **順次戦闘**: FIFO方式による待機敵との連続戦闘システム
- **双方向ダメージ**: プレイヤー(基本20ダメージ+武器強化) ⇔ 戦闘ターゲット敵(15ダメージ)
- **死ぬまで戦闘**: 距離に関係なくHPが0になるまで戦闘継続
- **攻撃アニメーション**: プレイヤーの剣振り、敵の突進攻撃
- **視覚フィードバック**: HPバー・ダメージ数値・攻撃エフェクト
- **ゲーム進行制御**: 戦闘中の背景スクロール停止・敵移動は継続

### コインシステム
- **コインドロップ**: 敵死亡時に10-20コインのランダム生成
- **回転アニメーション**: 2フレーム画像による回転エフェクト
- **価値表示**: コイン横に"+10"などの価値テキスト表示
- **自動取得**: スポーン時の即座取得・衝突判定不要
- **浮遊エフェクト**: sin波による上下浮遊アニメーション
- **UI連携**: 取得コインのリアルタイムUI反映
- **自動消失**: 2秒後の自動削除システム

### 育成システム
- **キャラクターレベルアップ**: コイン消費でHPを20ずつ増加
- **武器レベルアップ**: コイン消費で攻撃力を5ずつ増加
- **コスト計算**: レベル×基本コスト（キャラ10・武器10）で段階的増加
- **HP増加仕様**: レベルアップ時は全回復せず、増加分のみ現在HPに追加
- **視覚フィードバック**: ボタンアニメーション・ステータス表示・コスト表示
- **永続データ**: PlayerStatsシングルトンによる状態管理

### シーン管理システム
- **タイトル画面**: フェードインアニメーション・ボタン押下効果
- **シーン遷移**: スムーズなフェードイン/アウト効果
- **ゲームオーバー画面**: 結果表示（到達距離・獲得コイン）
- **シーンループ**: タイトル→メインゲーム→ゲームオーバー→タイトル

### テスト機能
- **手動テスト**: UI ボタンでの動作確認
- **自動テスト**: F12キーで包括的テスト実行
  - プレイヤー機能テスト
  - スクロールシステムテスト  
  - 定数整合性テスト
  - 統合テスト

## アーキテクチャ

### 階層化設計
1. **基底クラス**: ScrollerBase・EnemyBase による共通処理統一
2. **具象クラス**: Background/Ground スクローラー・BasicEnemy 特化実装
3. **管理クラス**: ScrollManager による統一制御・UIPositionHelper による UI 計算統一
4. **ユーティリティクラス**: HPBar・DamageText による再利用可能 UI コンポーネント
5. **定数管理**: 論理的グループ分けによる整理

### 主要改善点
- **継承アーキテクチャ**: 基底クラスによる機能の共通化
- **複数敵同時出現システム**: アクティブ敵配列・待機キュー・戦闘ターゲット管理
- **時間ベース敵出現**: Timer による5秒間隔無限出現・距離依存からの脱却
- **1対1戦闘制御**: 複数敵環境での明確な戦闘対象管理・通り抜け防止
- **順次戦闘システム**: FIFO方式による待機敵との連続戦闘
- **UI 位置計算統一**: UIPositionHelper による重複コード削減・動的位置計算
- **再利用可能 UI**: HPBar・DamageText クラスによるコンポーネント化
- **視覚フィードバック強化**: HPバー・ダメージ数値・攻撃アニメーション
- **シーン管理システム**: SceneTransition によるスムーズな画面遷移
- **ゲームループ完成**: タイトル→ゲーム→ゲームオーバー→タイトルの循環
- **育成システム**: PlayerStats による永続ステータス管理・コイン消費型レベルアップ
- **拡張可能設計**: 新敵タイプ・新機能の簡単追加
- **エラーハンドリング**: 安全なリソース読み込み処理
- **テスト拡張**: 包括的なテストカバレッジ

## 今後の拡張予定

### ゲームプレイ機能
- **敵バリエーション**: FAST・STRONG・BOSS敵タイプの実装
- **スキルシステム**: 特殊攻撃・能力強化機能
- **セーブシステム**: 育成データの永続化

### 技術改善
- **GUT (Godot Unit Test)**: より高度なテストフレームワーク導入
- **パフォーマンス最適化**: 大量敵出現時の処理効率化

### UI/UX向上
- **視覚エフェクト**: 戦闘時のエフェクト・パーティクル
- **サウンドシステム**: BGM・効果音の統合