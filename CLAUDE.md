# CLAUDE.md

このファイルは Claude Code (claude.ai/code) がこのリポジトリでコードを扱う際のガイダンスを提供します。

## プロジェクト概要

auto-rogue プロジェクト - スマホ縦画面向けの放置ローグライクゲーム

### MVP 仕様 (最小実行可能プロダクト)

#### 画面構成

- **上部 1/3**: プレイエリア（プレイヤー・敵・背景スクロール）
- **下部 2/3**: UI エリア（拠点メニュー・強化・ボタン類）
- **解像度**: 720x1280 (スマホ縦画面)

#### ゲームループ

1. プレイヤーキャラが自動で前進
2. 敵と遭遇 → 自動戦闘
3. 敵を倒すとゴールドをドロップ
4. 冒険失敗（HP ゼロ）で拠点に戻る
5. 獲得したゴールドでキャラを強化
6. 再び冒険に出発

#### キャラクター仕様

- **プレイヤー**: 画面左下寄り固定位置で歩行アニメーション
- **敵**: 右端から出現し左方向に移動、プレイヤーに近づくと戦闘
- **戦闘**: 自動で交互攻撃（一定間隔）
- **ステータス**: HP、攻撃力、攻撃間隔

#### 技術要素

- **背景スクロール**: 右 → 左ループで移動感演出
- **シーン遷移**: 冒険シーン ⇔ 拠点シーン
- **セーブデータ**: JSON 形式でゴールド・強化値保存

## 開発状況

### 現在の実装状況

#### 完了した機能
- ✅ **基本ゲームシステム**: プレイヤー・敵・戦闘システムの実装
- ✅ **スクロールシステム**: 背景・地面の無限スクロール
- ✅ **戦闘システム**: プレイヤーと敵の接近戦闘・攻撃アニメーション
- ✅ **エネミーシステム**: 基底クラス継承による敵タイプ管理
- ✅ **コードリファクタリング**: 共通機能の統合と最適化

#### 実装中の機能
- 🚧 **ゲームプレイ拡張**: より多様な敵タイプと戦闘要素

#### アーキテクチャ改善
- **エネミー継承システム**: EnemyBase による拡張可能な敵システム
- **戦闘システム統合**: プレイヤー・敵・UI の連携制御
- **コード整理**: 関数の統一化と可読性向上

## 開発コマンド

- **実行**: Godot エディタで F6 キー
- **テスト**: 実行中に F12 キーでテスト実行
- **プロジェクトファイル**: project.godot

## プロジェクト構造

### コアファイル
- `src/scenes/`: シーンファイル (.tscn)
  - `MainScene.tscn`: エントリポイント
  - `Player.tscn`: プレイヤーキャラクター
  - `BasicEnemy.tscn`: 基本敵キャラクター
- `src/scripts/`: スクリプトファイル (.gd)
  - `GameConstants.gd`: 定数管理 (autoload)
  - `Player.gd`: プレイヤー制御API（武器・攻撃システム含む）
  - `MainScene.gd`: メインシーン・戦闘管理
  - `TestPlayer.gd`: テスト機能

### エネミーシステム
- `EnemyBase.gd`: 敵キャラクターの基底クラス
- `BasicEnemy.gd`: 基本敵（突進攻撃タイプ）


### スクロールシステム
- `ScrollerBase.gd`: スクロール要素の基底クラス
- `BackgroundScroller.gd`: 背景スクロール制御
- `GroundScroller.gd`: 地面スクロール制御
- `ScrollManager.gd`: 複数スクローラーの統一管理

### アセット
- `assets/sprites/kenney_pixel-platformer/`: ゲーム素材
  - `Tiles/Backgrounds/`: 背景画像 (tile_0008~0011)
  - `Tiles/Characters/`: キャラクター画像 (tile_0000~0001)
  - `Tiles/`: 地面タイル (tile_0022)

## アーキテクチャ

### 階層化設計
1. **基底クラス**: ScrollerBase・EnemyBase で共通処理を統一
2. **具象クラス**: BackgroundScroller, GroundScroller, BasicEnemy で特化実装
3. **管理クラス**: ScrollManager で複数要素の制御
4. **定数管理**: GameConstants で論理的グループ分け

### プレイヤーシステム
- **スプライトアニメーション**: tile_0000/0001 の2フレーム歩行
- **武器システム**: 剣による攻撃アニメーション
- **動的スケール**: GameConstants.PLAYER_SPRITE_SCALE (3.0倍)
- **地面位置調整**: 自動計算による適切な接地
- **シグナル通知**: position_changed, player_reset, attack_started/finished

### エネミーシステム  
- **継承アーキテクチャ**: EnemyBase 基底クラスによる拡張可能設計
- **戦闘状態管理**: 戦闘開始/終了の自動判定とアニメーション制御
- **攻撃パターン**: BasicEnemy の突進攻撃アニメーション
- **タイプシステム**: EnemyType enum による敵種別管理

### 戦闘システム
- **接近判定**: プレイヤーと敵の距離による自動戦闘開始
- **攻撃連携**: プレイヤーと敵の同期攻撃アニメーション
- **ゲーム進行制御**: 戦闘中のスクロール停止機能

### スクロールシステム
- **無限ループ**: 背景4枚・地面1枚の連続スクロール
- **統一制御**: ScrollManager による速度・状態管理
- **拡張性**: 新しいスクロール要素の簡単追加

### コード品質向上
- **継承設計**: 基底クラスによる機能の共通化
- **一貫したログ**: 全クラスで統一されたログ出力形式
- **エラーハンドリング**: 安全なリソース読み込み処理

## テスト駆動開発

### 包括的テストスイート
- **プレイヤーテスト**: 移動・アニメーション・API
- **スクロールテスト**: ScrollManager・スクローラー状態
- **定数整合性テスト**: GameConstants の論理チェック
- **統合テスト**: システム全体の連携確認

### テスト実行
- **F12キー**: 全自動テスト実行
- **手動テスト**: UI ボタンでの動作確認
- **デバッグログ**: 構造化された詳細ログ

## ユーザー通知の挙動

以下のタイミングで音を鳴らしてユーザーに通知してください：

1. **レスポンス完了時**: 毎回のレスポンス終了時に通知コマンドを打つ
2. **Bash コマンド実行前**: ユーザーの許可が必要な場合の直前に通知コマンドを打つ
3. **ファイル編集前**: ユーザーの許可が必要な場合の直前に通知コマンドを打つ

通知コマンド

`afplay /Users/takumi_morita/otukare.mp3 && osascript -e 'display notification "Claude Code作業完了しました" with title "Claude Code" sound name "Ping"'`

必ず レスポンス終了時, Bash コマンド実行前, ファイル編集前 に通知コマンドを打ち、ユーザーの入力待ち状態になったことを明確に示してください。
