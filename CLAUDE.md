# CLAUDE.md

このファイルは Claude Code (claude.ai/code) がこのリポジトリでコードを扱う際のガイダンスを提供します。

## プロジェクト概要

auto-rogue プロジェクト - スマホ縦画面向けの放置ローグライクゲーム

### 味方キャラクター構成
- **GreenCharacter (みどりくん)**: 近距離戦闘キャラクター（80px攻撃範囲）
- **RedCharacter (あかさん)**: 遠距離魔法攻撃キャラクター（300px攻撃範囲）

### MVP 仕様 (最小実行可能プロダクト)

#### 画面構成

- **上部 1/3**: プレイエリア（プレイヤー・敵・背景スクロール）
- **下部 2/3**: UI エリア（拠点メニュー・強化・ボタン類）
- **解像度**: 720x1280 (スマホ縦画面)

#### ゲームループ

1. 味方キャラクター（GreenCharacter & RedCharacter）が自動で前進
2. Enemyと遭遇 → 自動戦闘（先制攻撃はRedCharacter）
3. Enemyを倒すとゴールドをドロップ
4. 冒険失敗（全キャラHP ゼロ）で拠点に戻る
5. 獲得したゴールドで味方キャラを強化
6. 再び冒険に出発

#### キャラクター仕様

- **GreenCharacter (みどりくん)**: 画面左下寄り固定位置で歩行アニメーション、近距離戦闘
- **RedCharacter (あかさん)**: 解放後に追加、遠距離魔法攻撃、先制攻撃
- **Enemy**: 右端から出現し左方向に移動、味方キャラに近づくと戦闘
- **戦闘**: 自動で交互攻撃（個別タイマー間隔）
- **ステータス**: HP、攻撃力、攻撃間隔

#### 技術要素

- **背景スクロール**: 右 → 左ループで移動感演出
- **シーン遷移**: 冒険シーン ⇔ 拠点シーン
- **セーブデータ**: JSON 形式でゴールド・強化値保存

## 開発状況

### 武器セーブ・ロードシステム修正 (2025/6/16)

#### 武器レベル永続化問題の解決

- ✅ **全武器セーブ・ロード対応**: ベーシック武器以外も正常にセーブ・ロードされるよう修正
- ✅ **包括的デバッグシステム**: 武器レベルの保存・復元過程を詳細ログで追跡
- ✅ **データ整合性検証**: セーブ前後での武器レベル一致確認システム
- ✅ **手動修復機能**: `PlayerStats.fix_weapon_levels()`による武器レベル問題の修復

#### 拡張されたデバッグ機能

- ✅ **武器レベル検証**: `_debug_verify_weapon_levels()`で全武器の状態確認
- ✅ **強制同期機能**: `_debug_force_sync_all_weapons()`で武器レベルの強制同期
- ✅ **全武器テスト**: `_debug_test_all_weapons()`で全武器の装備・アップグレードテスト
- ✅ **セーブ・ロード詳細ログ**: 各段階での武器レベル状態を詳細記録

#### 技術的改善

- **根本原因解明**: 装備中武器のみアップグレード可能な仕様の明確化
- **データフロー最適化**: WeaponSystem ↔ PlayerStats間の双方向同期強化
- **エラー検出強化**: 武器レベル不整合の自動検出とアラート機能
- **後方互換性維持**: 既存セーブデータとの完全互換性保持

#### 実装された機能

- **全武器永続化**: steel_sword, fire_sword, magic_staffのレベルも正常に保存
- **リアルタイム検証**: セーブ・ロード時の武器レベル状態リアルタイム確認
- **自動修復システム**: 武器レベル不整合時の自動検出・修復機能
- **開発者支援ツール**: デバッグ用の武器状態確認・修復メソッド群

### 武器システム＆タブUIシステム実装 (2025/6/15)

#### キャラクター別武器装備システム実装

- ✅ **WeaponSystem.gd**: 包括的な武器管理システム
  - 武器タイプ別管理（SWORD/STAFF）とレアリティシステム（COMMON/RARE/EPIC/LEGENDARY）
  - キャラクター別武器装備・強化システム
  - 武器データベースとダメージ計算機能

- ✅ **タブベースUIシステム**: パズドラ風の魅力的なタブUI
  - 5つの正方形タブアイコン（育成/武器/インベントリ/クエスト/設定）
  - 画面下部配置、パズドラ風の丸いボタンデザイン
  - 弾むアニメーションと発光エフェクト

- ✅ **武器専用UI**: 独立した武器管理画面
  - キャラクター別タブ（みどりくん/あかさん）
  - 武器レアリティによる色分け表示
  - 装備切り替えとアップグレード機能

#### UI改善

- ✅ **UpgradeUI分離**: 武器関連パネルを武器タブに完全移行
- ✅ **キャラクター名統一**: 「キャラクター」表示を「みどりくん」に修正
- ✅ **PlayerStats統合**: WeaponSystemとの後方互換性維持
- ✅ **パズドラ風タブ**: カラフルで立体的な丸いタブボタン

#### 実装された機能

- **武器システム**: キャラクター別武器装備・レアリティ・強化システム
- **タブナビゲーション**: スマホ画面に最適化された5タブ構成
- **パズドラ風UI**: 弾むアニメーション・発光エフェクト・グラデーション
- **後方互換性**: 既存セーブデータとの完全互換

## 開発状況

### 味方キャラクター命名統一 & RedCharacter攻撃システム改善 (2025/6/13)

#### キャラクター命名統一完了

- ✅ **コードベース全体の命名統一**: GreenCharacter(みどりくん) & RedCharacter(あかさん)の一貫性確立
- ✅ **Player.gdの統一**: 全コメント・ログを「GreenCharacter (みどりくん)」に統一
- ✅ **RedCharacter.gdの統一**: 全コメント・ログを「RedCharacter (あかさん)」に統一
- ✅ **MainScene.gdの管理明確化**: 味方キャラとEnemyの管理を明確化
- ✅ **PlayerStats.gdの統一**: 味方キャラクターステータス管理に統一
- ✅ **BlueMagicBullet.gdの統一**: RedCharacter(あかさん)用魔法弾に統一

#### RedCharacter攻撃システム改善

- ✅ **先制攻撃システム**: RedCharacterが攻撃範囲300pxで先制攻撃開始
- ✅ **即座初回攻撃**: 戦闘開始時に待機時間なしで即座に魔法弾発射
- ✅ **魔法弾サイズ調整**: 青い魔法弾のサイズを適切に調整（4倍→1倍）
- ✅ **画像パス修正**: RedCharacterのスプライト画像をtile_0004/0005に修正

#### 実装された機能

- **命名規則統一**: 味方キャラクターとEnemyの明確な区別
- **先制攻撃**: 攻撃範囲の広いRedCharacterが確実に先に攻撃
- **即座戦闘開始**: RedCharacterの戦闘開始時に即座に初回攻撃実行
- **視覚的統一**: コメント・ログ・UI表示の一貫性確保

### UI・UX大幅改善 (2025/6/13)

#### UI重複問題の解決

- ✅ **ダメージテキスト重複改善**: プレイヤーダメージ（左側移動）・敵ダメージ（右側移動）の分離表示
- ✅ **回復テキスト重複表示修正**: アイコン付き単一表示への統一・不要な重複削除
- ✅ **コイン・ポーションパネル配置最適化**: 縦方向分離による視認性向上

#### 敵レベルシステム実装

- ✅ **敵レベル表示**: HPバー上部に「Lv.1」形式で表示・黒文字ベース
- ✅ **ランダムレベル生成**: 1-3の範囲でランダム設定
- ✅ **レベル連動能力調整**: HP・移動速度がレベルに応じて1.0～2.0倍にスケーリング
- ✅ **動的レイアウト**: HPバーの18px上に自動配置

#### スマートUI配置システム実装

- ✅ **透過部分自動検出**: ピクセルスキャンによる実際のキャラクター領域自動算出
- ✅ **高性能キャッシュシステム**: テクスチャ解析結果のキャッシュ化
- ✅ **動的HPバー配置**: 透過部分を考慮した正確な位置計算
- ✅ **統一配置ロジック**: プレイヤー・敵・ダメージテキストの一貫した配置

#### ビジュアル改善

- ✅ **剣の向き修正**: 左右反転により刃が正しい方向を向く
- ✅ **UI要素間隔最適化**: キャラクター・HPバー・レベル表示の適切な間隔調整

#### 実装された機能

- **ダメージテキスト方向制限**: プレイヤー被ダメージは左側のみ、敵被ダメージは右側のみに移動
- **回復テキスト統一**: ポーションアイコン付きテキストのみ表示、重複削除
- **パネル配置分離**: コインパネル（元位置）・ポーションパネル（上側40px）の縦配置
- **敵レベルシステム**: ランダムレベル・能力スケーリング・視覚的レベル表示
- **透過部分検出**: アルファ値0.1以上のピクセルを不透明とみなし境界を自動算出
- **スマート配置**: 実際のキャラクター部分から20px上にHPバー配置

### コードリファクタリング実施 (2025/1/13)

#### 実施した改善

- ✅ **ユーティリティクラス作成**: GameLogger・GameUtils・MovementCalculatorの統一化ヘルパー
- ✅ **コードドキュメンテーション改善**: 全主要クラスのコメント・説明強化
- ✅ **命名規則統一**: HPBar.gdのシャドウイング問題修正
- ✅ **エラーメッセージ改善**: ScrollerBase.gdの抽象メソッドエラー強化
- ✅ **定数管理改善**: GameConstants.gdの構造化コメント追加

#### 作成されたユーティリティクラス

- **GameLogger.gd**: 統一ログシステム（デバッグ・情報・警告・エラー）
- **GameUtils.gd**: 汎用ヘルパー（テクスチャ読み込み・プレイヤー検索・ノード管理）
- **MovementCalculator.gd**: 移動計算統一（敵相対速度・スクロール連動）

### 戦闘距離システム改善 (2025/1/13)

#### 問題解決

- ✅ **戦闘距離問題修正**: プレイヤー攻撃射程（80px）vs魔法使い敵接敵距離（300px）の不整合解決
- ✅ **2段階戦闘システム**: 接近状態（80-300px）と戦闘状態（0-80px）に分離
- ✅ **背景スクロール制御改善**: 接近時は背景継続、戦闘時は背景停止
- ✅ **敵の相対移動システム**: 敵が戦闘中でも背景と相対的に移動、プレイヤーが適切に接近可能

#### 実装された機能

- **接近状態（80px～300px）**: 敵は魔法攻撃可能、プレイヤーは攻撃不可、背景スクロール継続
- **戦闘状態（0px～80px）**: プレイヤーも攻撃開始、背景スクロール停止
- **プレイヤー攻撃射程制限**: 80ピクセル以内の敵のみにダメージ
- **2段階敵管理**: `approaching_enemies`と`battle_enemies`の分離管理
- **敵の相対移動制御**: 戦闘状態でも背景と同期して相対的に移動（相対速度0）

#### 技術的改善

- **EnemyBase.gd**: 常時物理プロセスで背景と相対的な移動を実現
- **MageEnemy.gd**: 魔法使い敵も背景と相対的な移動に統一
- **MainScene.gd**: `is_walking`フラグ依存を削除、相対移動による自動管理
- **GameConstants.gd**: プレイヤー攻撃射程（80px）定数追加

### 現在の実装状況

#### 完了した機能

- ✅ **基本ゲームシステム**: プレイヤー・敵・戦闘システムの実装
- ✅ **スクロールシステム**: 背景・地面の無限スクロール
- ✅ **戦闘システム**: プレイヤーと敵の双方向ダメージ・死ぬまで戦闘継続
- ✅ **HPシステム**: プレイヤー・敵の HP 管理と視覚的 HP バー表示
- ✅ **ダメージ表示システム**: フロート式ダメージ数値アニメーション
- ✅ **エネミーシステム**: 基底クラス継承による敵タイプ管理
- ✅ **UI 位置計算システム**: 動的スプライトサイズ対応の位置計算
- ✅ **コードリファクタリング**: UIPositionHelper による共通機能統合
- ✅ **コインシステム**: 敵撃破時の即座コイン取得・UI反映・視覚フィードバック（10-20コイン）
- ✅ **タイトル画面**: フェードインアニメーション・ゲーム開始ボタン
- ✅ **シーン遷移システム**: スムーズなフェードイン/アウト効果
- ✅ **ゲームオーバー画面**: 結果表示・タイトルへの復帰
- ✅ **育成システム**: コイン消費によるキャラクター・武器・攻撃速度・ポーション効果レベルアップ
- ✅ **ステータス管理**: PlayerStatsシングルトンによる永続的データ管理
- ✅ **複数敵同時出現システム**: 時間ベース無限敵出現
- ✅ **複数敵同時攻撃システム**: 複数の敵が独立して同時攻撃・個別タイマー管理
- ✅ **セーブシステム**: オートセーブ・即座セーブ・データ削除機能の完全実装
- ✅ **回復薬システム**: 20%確率でのポーションドロップ・即座HP回復・視覚的フィードバック
- ✅ **UI改善**: 育成パネルの共通化・2x2グリッド配置・中央揃え
- ✅ **敵移動システム改善**: 背景スクロールと連動した相対速度制御
- ✅ **個別接敵距離システム**: 敵タイプ別の接敵距離設定機能
- ✅ **魔法使い敵の実装**: 遠距離攻撃・魔法弾システム・新敵タイプ追加
- ✅ **セーブシステム拡張**: 攻撃速度・ポーション効果レベルの永続化対応
- ✅ **RedCharacterシステム**: 遠距離魔法攻撃・先制攻撃・即座戦闘開始
- ✅ **味方キャラクター命名統一**: GreenCharacter & RedCharacterの一貫した命名規則
- ✅ **BlueMagicBulletシステム**: RedCharacter専用魔法弾・サイズ調整・視覚改善

#### 実装中の機能

- 🚧 **ゲームプレイ拡張**: より多様な敵タイプと戦闘要素

#### アーキテクチャ改善

- **エネミー継承システム**: EnemyBase による拡張可能な敵システム
- **戦闘システム統合**: プレイヤー・敵・UI の連携制御
- **コード整理**: 関数の統一化と可読性向上

## 開発コマンド

- **実行**: Godot エディタで F6 キー
- **テスト**: 実行中に F12 キーでテスト実行
- **プロジェクトファイル**: project.godot

### デバッグ用ユーティリティ

#### 武器システムデバッグ
- **武器レベル確認**: `PlayerStats.debug_weapon_levels()` - 現在の武器レベル状態を詳細表示
- **武器レベル修復**: `PlayerStats.fix_weapon_levels()` - 武器レベル問題の手動修復
- **全武器テスト**: `WeaponSystem._debug_test_all_weapons()` - 全武器の装備・アップグレードテスト
- **武器データベース表示**: `WeaponSystem._debug_show_all_weapon_levels()` - 武器データベース状態表示

#### セーブデータデバッグ
- **セーブ前後検証**: 自動実行される武器レベル整合性チェック
- **詳細ログ出力**: `DEBUG_LOG_ENABLED = true`で全保存・復元過程を追跡

## プロジェクト構造

### コアファイル

- `src/scenes/`: シーンファイル (.tscn)
  - `TitleScene.tscn`: タイトル画面（ゲーム開始エントリポイント）
  - `MainScene.tscn`: メインゲーム画面（GameOverScreen含む）
  - `Player.tscn`: GreenCharacter (みどりくん) キャラクター（HP バー含む）
  - `RedCharacter.tscn`: RedCharacter (あかさん) キャラクター（HP バー含む）
  - `BlueMagicBullet.tscn`: RedCharacter専用青い魔法弾
  - `BasicEnemy.tscn`: 基本敵キャラクター（HP バー含む）
  - `Coin.tscn`: コイン（回転アニメーション・価値表示）
  - `HealthPotion.tscn`: 回復薬（浮遊アニメーション・回復量表示）
  - `UpgradePanel.tscn`: 共通育成パネル（レベルアップUI）
- `src/scripts/`: スクリプトファイル (.gd)
  - `GameConstants.gd`: 定数管理 (autoload)
  - `SceneTransition.gd`: シーン遷移管理 (autoload)
  - `PlayerStats.gd`: プレイヤーステータス管理 (autoload)
  - `SaveManager.gd`: セーブ/ロード管理 (autoload)
  - `TitleScene.gd`: タイトル画面制御（オートセーブ検出・自動ボタンテキスト変更）
  - `Player.gd`: GreenCharacter (みどりくん) 制御 API（武器・攻撃・HP・コイン収集システム）
  - `RedCharacter.gd`: RedCharacter (あかさん) 制御 API（魔法攻撃・遠距離戦闘・HP・杖システム）
  - `BlueMagicBullet.gd`: RedCharacter専用青い魔法弾制御
  - `MainScene.gd`: メインシーン・戦闘・ダメージ・ゴールドUI管理・オートセーブ
  - `GameOverScreen.gd`: ゲームオーバー画面制御
  - `UpgradeUI.gd`: 育成画面UI制御
  - `TestPlayer.gd`: テスト機能

### エネミーシステム

- `EnemyBase.gd`: 敵キャラクターの基底クラス（HP・ダメージ・コイン生成・個別接敵距離システム含む）
- `BasicEnemy.gd`: 基本敵（突進攻撃タイプ）
- `MageEnemy.gd`: 魔法使い敵（遠距離攻撃タイプ）

### HPシステム

- `HPBar.gd`: HP バー表示用ユーティリティクラス
- 動的 HP 管理・色変化・シグナル通知機能

### ダメージ表示システム

- `DamageText.gd`: フロート式ダメージ数値表示クラス
- アニメーション付きダメージ表示

### UI位置計算システム

- `UIPositionHelper.gd`: UI要素位置計算ヘルパークラス
- 動的スプライトサイズ対応・共通位置計算ロジック

### コインシステム

- `Coin.gd`: コイン表示・価値表示・自動取得・消失システム
- 敵撃破時の即座取得・視覚フィードバック・UI反映

### 回復薬システム

- `HealthPotion.gd`: 回復薬表示・回復量表示・視覚的フィードバック
- 敵撃破時の20%確率ドロップ・即座HP回復・浮遊アニメーション

### 魔法弾システム

- `MagicBullet.gd`: 魔法使い敵の遠距離攻撃弾クラス
- プレイヤー追跡・距離判定・即座ダメージ処理

### シーン管理システム

- `SceneTransition.gd`: シーン遷移管理（シングルトン）
- `TitleScene.gd`: タイトル画面・ゲーム開始制御
- `GameOverScreen.gd`: ゲームオーバー画面・結果表示

### 育成・ステータス管理システム

- `PlayerStats.gd`: プレイヤーステータス管理（シングルトン）
- `UpgradeUI.gd`: 育成画面UI・レベルアップ制御（4種類レベルアップ対応）

### セーブシステム

- `SaveManager.gd`: オートセーブ管理（シングルトン）
- **自動保存機能**:
  - 30秒間隔でのバックグラウンド保存
  - ゲーム開始時の初回保存
  - コイン消費時の即座保存（レベルアップ等）
- **データ管理**:
  - コイン・キャラレベル・武器レベル・攻撃速度レベル・ポーション効果レベルの永続化
  - タイムスタンプ・日時情報の記録
  - user://saves/autosave.dat での安全な保存
  - 後方互換性維持（既存セーブデータの自動アップグレード）
- **ユーザーインターフェース**:
  - タイトル画面でのデータ削除ボタン（セーブ存在時のみ表示）
  - 確認モーダルによる誤削除防止
  - セーブ検出による自動ボタンテキスト変更

### スクロールシステム

- `ScrollerBase.gd`: スクロール要素の基底クラス
- `BackgroundScroller.gd`: 背景スクロール制御
- `GroundScroller.gd`: 地面スクロール制御
- `ScrollManager.gd`: 複数スクローラーの統一管理

### アセット

- `assets/sprites/kenney_pixel-platformer/`: ゲーム素材
  - `Tiles/Backgrounds/`: 背景画像 (tile_0008~0011)
  - `Tiles/Characters/`: キャラクター画像 (tile_0000~0001: GreenCharacter, tile_0004~0005: RedCharacter)
  - `Tiles/`: 地面タイル (tile_0022)、コイン画像 (tile_0151~0152)
- `assets/sprites/kenney_tiny-dungeon/`: 武器・アイテム素材
  - `Tiles/`: 武器画像 (tile_0103)、ポーション画像 (tile_0114)

## アーキテクチャ

### 階層化設計

1. **基底クラス**: ScrollerBase・EnemyBase で共通処理を統一
2. **具象クラス**: BackgroundScroller, GroundScroller, BasicEnemy で特化実装
3. **管理クラス**: ScrollManager で複数要素の制御、UIPositionHelper で UI 計算統一
4. **ユーティリティクラス**: HPBar・DamageText で再利用可能 UI コンポーネント
5. **定数管理**: GameConstants で論理的グループ分け

### 味方キャラクターシステム

#### GreenCharacter (みどりくん) システム
- **スプライトアニメーション**: tile_0000/0001 の 2 フレーム歩行
- **武器システム**: 剣による攻撃アニメーション・ダメージ処理（80px射程）
- **HP システム**: HP バー表示・ダメージ受信・死亡処理
- **ダメージ表示**: 被ダメージ時のフロート数値表示
- **コイン収集システム**: 自動コイン取得・総数管理・UI反映
- **動的スケール**: GameConstants.PLAYER_SPRITE_SCALE (3.0 倍)
- **地面位置調整**: 自動計算による適切な接地
- **シグナル通知**: position_changed, player_reset, attack_started/finished, player_died, coin_collected

#### RedCharacter (あかさん) システム  
- **スプライトアニメーション**: tile_0004/0005 の 2 フレーム歩行
- **魔法武器システム**: 杖による魔法攻撃・魔法弾発射（300px射程）
- **先制攻撃システム**: 攻撃範囲の広さによる確実な先制攻撃
- **即座戦闘開始**: 戦闘開始時に待機時間なしで即座に魔法弾発射
- **BlueMagicBullet**: 青い魔法弾による遠距離攻撃・適切なサイズ調整
- **HP システム**: 独立したHP バー表示・ダメージ受信・死亡処理
- **解放システム**: コイン1000で解放・解放後は永続的に使用可能

### エネミーシステム

- **継承アーキテクチャ**: EnemyBase 基底クラスによる拡張可能設計
- **戦闘状態管理**: 戦闘開始/終了の自動判定とアニメーション制御
- **攻撃パターン**: BasicEnemy の突進攻撃・ダメージ処理
- **HP システム**: 敵タイプ別 HP 設定・HP バー表示・死亡処理
- **ダメージ表示**: 被ダメージ時のフロート数値表示
- **コイン生成システム**: 死亡時の自動コイン生成・ランダム価値（10-20）
- **回復薬生成システム**: 死亡時の20%確率でポーションドロップ・即座回復処理
- **時間ベース出現**: 5秒間隔での自動敵出現・永続的無限ゲームプレイ
- **複数敵同時存在**: アクティブ敵配列による複数敵管理・画面上同時表示
- **タイプシステム**: EnemyType enum による敵種別管理
- **相対速度システム**: 背景スクロールと連動した自然な敵移動（相対速度50固定）
- **個別接敵距離システム**: 敵タイプ別の接敵距離設定（基本60・魔法使い300など）
- **魔法使い敵**: MAGEタイプの遠距離攻撃敵・魔法弾システム・接敵距離300・移動速度40

### 戦闘システム

- **複数敵同時攻撃**: 全ての戦闘中の敵が独立して同時に攻撃可能
- **個別攻撃タイマー**: 各敵が独自の攻撃間隔タイマーで攻撃管理
- **戦闘状態管理**: 各敵の個別戦闘状態（待機・移動・戦闘中）
- **自動戦闘開始**: プレイヤーとの距離判定による自動戦闘移行
- **双方向ダメージ**: プレイヤー ⇔ 複数敵の同時相互攻撃システム
- **攻撃タイミング**: 各敵の攻撃間隔による非同期攻撃
- **視覚フィードバック**: ダメージ数値・HP バー・攻撃アニメーション
- **ゲーム進行制御**: 戦闘中の背景スクロール停止・新規敵出現は継続
- **遠距離攻撃システム**: 魔法使い敵による魔法弾攻撃（距離300・2秒間隔・20ダメージ）

### スクロールシステム

- **無限ループ**: 背景 4 枚・地面 1 枚の連続スクロール
- **統一制御**: ScrollManager による速度・状態管理
- **拡張性**: 新しいスクロール要素の簡単追加

### コインシステム

- **即座取得**: 敵撃破と同時に自動取得（衝突判定不要）
- **視覚フィードバック**: コインアイコン（tile_0151/0152）の回転アニメーション
- **価値表示**: コイン横に "+10"~"+20" 数字表示（フォントメトリクス対応）
- **ランダムドロップ**: 10-20コインのランダム生成
- **UI統合**: リアルタイムゴールド表示更新（左上コインアイコン + 数値）
- **自動管理**: 2秒後の自動消失・プレイヤー総コイン数追跡

### 回復薬システム

- **即座回復**: 敵撃破時20%確率で即座にHP回復（衝突判定不要）
- **視覚フィードバック**: ポーションアイコン（tile_0114.png）の浮遊アニメーション
- **回復量表示**: ポーション横に "+20"~"+30" 緑色数字表示（レベル依存）
- **フロートテキスト**: 上昇する緑色回復量表示（視覚的フィードバック）
- **動的回復量**: ポーション効果レベルに応じた回復量（基本20 + レベル×5）
- **自動管理**: 3秒後の自動消失・視覚効果のみ

### シーン遷移システム

- **SceneTransition autoload**: グローバルなシーン遷移管理
- **フェード効果**: 黒画面フェードイン/アウトでスムーズな遷移
- **タイトル画面**: 段階的なフェードイン演出・ボタンアニメーション
- **ゲームオーバー画面**: 結果表示・スケールアニメーション登場
- **シーン構成**: タイトル → メインゲーム → ゲームオーバー → タイトル（ループ）

### 育成システム

- **PlayerStats シングルトン**: レベル・コイン数の永続管理
- **4種類のレベルアップ**:
  - キャラクター育成: レベルアップでHP増加（+20/レベル）
  - 武器育成: レベルアップで攻撃力増加（+5/レベル）
  - 攻撃速度育成: レベルアップで攻撃間隔短縮（-0.05秒/レベル、最小0.2秒）
  - ポーション効果育成: レベルアップで回復量増加（+5/レベル）
- **コストシステム**: レベル比例コスト（レベル×基本コスト、種類別基本コスト）
- **共通UIシステム**: UpgradePanelによる統一されたレベルアップUI
- **育成UI**: コイン数・レベルアップコスト・ステータス上昇量表示・2x2グリッド配置
- **アニメーション**: レベルアップ成功時のスケール・フラッシュ効果

### セーブシステム

- **SaveManager シングルトン**: 包括的なセーブ/ロード/削除管理
- **多段階オートセーブ**: 
  - 定期保存（30秒間隔）
  - トリガー保存（コイン消費時）
  - 開始時保存（ゲーム起動時）
- **インテリジェントUI**: 
  - セーブ検出による動的ボタンテキスト変更
  - セーブ存在時のみ削除ボタン表示
  - 確認モーダルによる安全な削除操作
- **堅牢なデータ管理**:
  - JSON形式での構造化データ保存
  - エラーハンドリング付きファイル操作
  - データ破損チェック機能
- **武器レベル永続化システム**:
  - 全武器レベルの個別保存（weapon_system_levels）
  - セーブ前後の武器レベル整合性検証
  - 詳細ログによる保存・復元過程の追跡
  - 武器レベル不整合の自動検出・修復機能
- **ユーザーエクスペリエンス**:
  - シームレスな進行状況復帰
  - 重要操作での即座保存
  - ESCキーによるモーダルキャンセル

### コード品質向上

- **継承設計**: 基底クラスによる機能の共通化
- **複数敵システム**: アクティブ敵配列・個別戦闘状態・独立攻撃タイマー管理
- **時間ベース設計**: Timer による敵出現・距離依存からの脱却
- **UI 位置計算統一**: UIPositionHelper による重複コード削減
- **動的位置計算**: スプライトサイズに基づく自動位置調整
- **ユーティリティクラス**: HPBar・DamageText の再利用可能設計
- **機能別セクション分け**: コードの可読性・保守性向上
- **一貫したログ**: 全クラスで統一されたログ出力形式
- **エラーハンドリング**: 安全なリソース読み込み処理

## テスト駆動開発

### 包括的テストスイート

- **プレイヤーテスト**: 移動・アニメーション・API
- **スクロールテスト**: ScrollManager・スクローラー状態
- **定数整合性テスト**: GameConstants の論理チェック
- **統合テスト**: システム全体の連携確認

### テスト実行

- **F12 キー**: 全自動テスト実行
- **手動テスト**: UI ボタンでの動作確認
- **デバッグログ**: 構造化された詳細ログ
